<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Form</title>
    <link rel="stylesheet" href="static/css/login.css">
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        p {
            color: rgb(252, 248, 248);
        }
    </style>
</head>

<body>
    <div class="login">
        <form class="login-form" id="loginform" action="{% url 'login2' %}" method="POST">
            {% csrf_token %}
            <div><span class="close-button"><a href="homepage1">&times;</a></span></div>
            <br><br>
            <div class="image"><img src="static/img/Kavin Logo.png" width="260px" alt=""></div>
            <div class="form-header">
                <p>Sign In into the online test portal</p>
            </div>
            <div class="form-group">
                <input type="text" class="form-input" id="username" name="username" placeholder="Username">
            </div>
            <div class="form-group">
                <input type="password" class="form-input" id="password" name="password" placeholder="Password">
            </div>
            <div class="form-group">
                <button class="form-button" type="submit">Login</button>
            </div>
            <div class="label">
                <span class="error">{{msg}}</span>
            </div>
            <div class="form-footer">
                Don't have an account yet? <a href="regspage">Sign up</a>
            </div>
        </form>
    </div>
    <script>
        function validateForm() {
          var username = document.getElementById('username').value;
          var password = document.getElementById('password').value;
      
          if (username.trim() === '') {
            swal({
              title: 'Error',
              text: 'Please enter a username.',
              icon: 'error',
              button: 'OK'
            });
            return false;
          }
      
          if (password.trim() === '') {
            swal({
              title: 'Error',
              text: 'Please enter a password.',
              icon: 'error',
              button: 'OK'
            });
            return false;
          }
    
          return true;
        }
    
      
        var form = document.getElementById('loginform');
        form.addEventListener('submit', function(event) {
        // Prevent form submission if validation fails
        if (!validateForm()) {
            event.preventDefault();
        } else {
            event.preventDefault();
    
            var formData = new FormData(form);
    
            var xhr = new XMLHttpRequest();
            xhr.open('POST', form.action, true);
            xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
            xhr.onreadystatechange = function() {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status === 200) {
                res = JSON.parse(xhr.response);
                if (res.hasOwnProperty("error")) {
                        swal({
                        title: 'Error',
                        text: res['error'],
                        icon: 'error',
                        button: 'OK'
                        });
                    } 
                    else {
                        if (res.usertype == '1')
                        {
                            window.location.href = 'admin_dashboard';
                        }
                        else{
                            window.location.href = 'userpage';
                        }
                        console.log("before debugger");
                        debugger;
                    }
                } else {
                // Form submission failed, handle the error
                swal({
                    title: 'Error',
                    text: 'Failed to submit the form. Please try again.',
                    icon: 'error',
                    button: 'OK'
                });
                }
            }
            };
            // Send the form data
            xhr.send(formData);
        }});
        
      </script>
</body>

</html>